<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.hrms.mappers.workMapper">
	
	<select id="select" parameterType="java.util.Map" resultType="edu.hrms.vo.WorkVO">
		SELECT * FROM work
			WHERE userid = #{userid} 
				AND DATE = #{now}
	</select>
	
	<select id="selectThisWeek" parameterType="java.util.Map" resultType="String">
		SELECT SEC_TO_TIME(SUM(TIME_TO_SEC(SUBTIME(end, start))))
			FROM work 
    		WHERE date BETWEEN #{startDay} and #{endDay}
	</select>
	
	<insert id="insert" parameterType="java.util.Map">	
		INSERT INTO work (userid, date, start) 
		          VALUES (#{userid} , #{date} , #{time})
	</insert>
	
	<update id="update" parameterType="java.util.Map">
		UPDATE work 
			SET end = #{time}
		   WHERE userid = #{userid}
		   	AND date = #{date}
	</update>
	
	<insert id="insertOvertime" parameterType="java.util.Map">	
		INSERT INTO overtime (userid, date, start, end, content) 
						VALUES   (#{userid}, #{date}, #{start}, #{end}, #{content})
	</insert>
	
	<select id="getSignLineList" parameterType="java.util.Map" resultType="edu.hrms.vo.SignLineVO">
		SELECT s.signLineNo, s.userid, u.position, s.type, s.signOrder 
			FROM signline s 
			INNER JOIN user u ON s.userid = u.userid
			WHERE (type='O' OR type='A') AND
		  			(SUBSTRING(s.userid,1,2) = SUBSTRING(#{userid},1,2) OR s.userid='99000') AND
		  			u.position IN 
		  			<foreach item="item" index="index" collection="positionArr" open="(" separator="," close=")">
		  				#{item}
		  			</foreach>
	</select>
	
	<select id="getMaxNoByUserId" parameterType="String" resultType="int">
		SELECT * FROM overtime 
			WHERE overtimeno = (SELECT MAX(overtimeNo) FROM overtime WHERE userid = #{userid})
	</select>
	
	<insert id="insertSign" parameterType="List">
		INSERT INTO overtimesign ()
	</insert>
	
</mapper>



