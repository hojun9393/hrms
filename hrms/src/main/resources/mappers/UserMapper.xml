<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
			"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="edu.hrms.mappers.userMapper">
	
	<select id="selectLogin" parameterType="String" resultType="java.util.Map">
		SELECT userid AS username, password, enabled, authority, name, email
				, dept, phone, position, joindate, IFNULL(retiredate, '-') AS retiredate
				, state, addr, keepVaca, useVaca,
			CASE LENGTH(phone)
			WHEN 11 THEN CONCAT(LEFT(phone, 3), '-', MID(phone, 4, 4), '-', RIGHT(phone, 4))
			WHEN 10 THEN CONCAT(LEFT(phone, 3), '-', MID(phone, 4, 3), '-', RIGHT(phone, 4))
			END AS phoneNumber,
			CASE WHEN dept = 'M' THEN '관리부'
	   	 	WHEN dept = 'D' THEN '개발부'
	        WHEN dept = 'S' THEN '영업부'
	        WHEN dept = 'P' THEN '기획부'
	        WHEN dept = 'H' THEN '인사부'
	        ELSE '부서미정' END AS deptCase,  
			CASE WHEN position = 'A' THEN '관리자'
	   	 	WHEN position = 'C' THEN '대표'
	        WHEN position = 'D' THEN '부장'
	        WHEN position = 'L' THEN '팀장'
	        WHEN position = 'E' THEN '사원'
	        ELSE '직급미정' END AS positionCase 
			FROM user
			WHERE userid = #{userid}
	</select>
	
	<insert id="insert" parameterType="java.util.Map">	
		insert into user(userid
		     		   , password
		     		   , name
		     		   ,enabled
		     		   , authority) 
		          values(#{userid}
		               , #{password}
		               ,#{name}
		               ,1
		               ,#{authority})
	</insert>
	
	<select id="selectUserAll" resultType="employeeVO">
		SELECT *,
		CASE LENGTH(phone)
		WHEN 11 THEN CONCAT(LEFT(phone, 3), '-', MID(phone, 4, 4), '-', RIGHT(phone, 4))
		WHEN 10 THEN CONCAT(LEFT(phone, 3), '-', MID(phone, 4, 3), '-', RIGHT(phone, 4))
		END AS phoneNumber,
		CASE WHEN dept = 'M' THEN '관리부'
   	 	WHEN dept = 'D' THEN '개발부'
        WHEN dept = 'S' THEN '영업부'
        WHEN dept = 'P' THEN '기획부'
        WHEN dept = 'H' THEN '인사부'
        ELSE '부서미정' END AS deptCase,  
		CASE WHEN position = 'A' THEN '관리자'
   	 	WHEN position = 'C' THEN '대표'
        WHEN position = 'D' THEN '부장'
        WHEN position = 'L' THEN '팀장'
        WHEN position = 'E' THEN '사원'
        ELSE '직급미정' END AS positionCase 
		FROM user;
	</select>
	
	<update id="updateUser" parameterType="employeeVO">
		UPDATE user SET 
		password = #{password}, 
		phone = #{phone}, 
		email = #{email}, 
		addr = #{addr} 
		WHERE userid = #{userid};
	</update>
	
</mapper>



